#!/usr/bin/env python

import click
import app.local_file_persistence as persistence
from app.task import Task
from os import path
from app import config
import cli_ui


@click.group()
def gtu():
    pass

@gtu.command()
@click.argument('task_title', required=True)
def add(task_title):
    click.echo('adding a new task')
    task = Task(task_title)
    persistence.save(task)

@gtu.command()
def ls():
    click.echo('ls tasks... pending implementation')
    for task in persistence.get_tasks():
        click.echo('task.title=' + task.title)
        click.echo(task.serialize())
    click.echo('Done')


@gtu.command()
@click.option('--file-persistence-base', required=False)
def init(file_persistence_base):
    click.confirm('Do you want to continue?\n\tThis will remove your current tasks and config.', abort=True)
    config_file = config.init()
    click.echo('init...')
    click.echo('config_file='+config_file)
    written_config = config.write(file_persistence_base)
    click.echo('written_config='+written_config)

@gtu.command()
def show_config():
    click.echo('config=' + config.get_str())


@gtu.command()
def details():
    tasks = {task.title: task for task in persistence.get_tasks()}
    choice = cli_ui.ask_choice("Select task, <Enter> to exit.", choices=list(tasks.keys()))
    if not choice:
        return

    selected_task = tasks[choice]
    pprint_task(selected_task)

def pprint_task(task):
    cli_ui.info(cli_ui.bold, cli_ui.blue, 'Title: ', cli_ui.reset, '"', task.title, '"', cli_ui.yellow, task.tags)
    cli_ui.info(cli_ui.bold, cli_ui.blue, 'Description: ', cli_ui.reset, '"', task.description, '"')

if __name__ == '__main__':
    gtu()
